<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  

  
  <title>
    
      ArchLinuxARM on BeagleBone Black: getting network working over USB &middot; 周宇盛的博客
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-08">

    

    

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A blog made from an IT lover about IT and other stuff (insert madness here). Based on the awesome <a href="https://github.com/poole/lanyon" target="_blank">Lanyon</a> theme, made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/jasonzhouu/jasonzhouu.github.io">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.3</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">周宇盛的博客</a>
            <small>网页制作 学习笔记 读书笔记</small>
          </h3>
          

        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">ArchLinuxARM on BeagleBone Black: getting network working over USB</h1>
  <span class="post-date">25 Jul 2015</span>
  <p>As written in title, this post will be about setting up a working USB connection
for <a href="http://archlinuxarm.org">ArchLinuxARM</a> (a port of the magnificent
<a href="https://www.archlinux.org">ArchLinux</a> for the ARM architecture).
This is made for this kind of setup:</p>

<ul>
  <li>a shared DHCP connection through NetworkManager (can be adapted to everything else though)</li>
  <li>a <em>BeagleBoneBlack</em> connected by mini-USB to the computer.</li>
</ul>

<p>With this tutorial you will have a working shared network between the <em>BeagleBoneBlack</em>
and your computer,
with included dynamic IP resolution (no more <em>ssh IP_HERE</em>).</p>

<p>Some thoughts:</p>

<ul>
  <li>I’ll say when commands have to be done on the <em>host</em> (see: your computer/laptop),
else they have to be done on the client (the <em>BeagleBoneBlack</em>).</li>
  <li>In a theoric way, this tutorial should be fine for any <strong>ArchLinuxARM</strong> device;
just pay a bit more of attention.</li>
  <li>I assume that the users reading this tutorial are a bit experienced (else <em>GTFO</em>);
also, the commands with before a <em>$</em>
will be commands that can be given as users, the ones with <em>!</em> should be given
by the user <em>root</em>.</li>
</ul>

<h2 id="lets-do-this">Let’s do this</h2>
<p>So, these are the steps:</p>

<ul>
  <li>
    <p>Install <strong><em>ArchLinuxARM</em></strong> (from now on <strong>ALARM</strong>) on your <em>BeagleBoneBlack</em>;
for this, I just suggest the
<a href="http://archlinuxarm.org/platforms/armv7/ti/beaglebone-black">official tutorial</a>.
For the following part of this tutorial, I assume you’ve installed your <strong>ALARM</strong>
(on MicroSD or on eMMC is the same).</p>
  </li>
  <li>From your <em>host</em>, share connection to your <em>BeagleBoneBoard</em>;
I did this by connecting the device using an Ethernet cable plus an USB for power.
Also, I allowed sharing connection through Ethernet with <em>NetworkManager</em>
    <ul>
      <li>install <em>dnsmasq</em>, as it will allow shared networking through NetworkManager</li>
      <li>open <em>nm-connection-editor</em></li>
      <li>Suggested: create a specific connection for the <em>BeagleBoneBlack</em> with <em>nm-connection-editor</em></li>
      <li>under IPv4 settings set “<em>Shared</em>”</li>
    </ul>
  </li>
  <li>I had then to use <em>nmap</em> on the <em>host</em> to find out the IP
    <ul>
      <li>go on NetworkManager</li>
      <li>find out the IP of the shared Ethernet network (<em>e.g. 10.42.0.1</em>)</li>
      <li>find the actual IP of the <em>BeagleBoardBlack</em> by inspecting the network, doing something like:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>nmap 10.42.0.1/24
<span class="c"># Here comes the output</span>
Starting Nmap 6.47 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2015-07-24 17:21 CEST
Nmap scan report <span class="k">for </span>10.42.0.1
Host is up <span class="o">(</span>0.00064s latency<span class="o">)</span>.
Not shown: 999 closed ports
PORT   STATE SERVICE
53/tcp open  domain
<span class="c"># Here it is!</span>
Nmap scan report <span class="k">for </span>10.42.0.143
Host is up <span class="o">(</span>0.00056s latency<span class="o">)</span>.
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh <span class="c"># See, SSH port is open</span>
Nmap <span class="k">done</span>: 256 IP addresses <span class="o">(</span>2 hosts up<span class="o">)</span> scanned <span class="k">in </span>2.56 seconds</code></pre></figure>

<ul>
  <li>Actually, connect from the <em>host</em> to your device with <strong>SSH</strong></li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>ssh root@10.42.0.143 <span class="c"># Use the IP found in the step before, user 'root' password 'root'</span></code></pre></figure>

<ul>
  <li>In order to work with just the USB cable, you need to download the <em>gadget-deadbeef-dhcp</em> package;
the package was meant to enable connections through USB, I made the <em>-dhcp</em> version to have dynamic IP
(we won’t have problem with it later). You can get it with a:</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>yaourt -S gadget-deadbeef-dhcp</code></pre></figure>

<p>Else, you will have to build it:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">! pacman -S base base-devel wget <span class="c"># Let's have all installed</span>
<span class="gp">$ </span>wget https://aur4.archlinux.org/cgit/aur.git/snapshot/gadget-deadbeef-dhcp.tar.gz
<span class="gp">$ </span>tar xf gadget-deadbeef-dhcp.tar.gz
<span class="gp">$ </span><span class="nb">cd </span>gadget-deadbeef-dhcp
<span class="gp">$ </span>makepkg -srci <span class="c"># Builds without dependencies problems, clean up the temporary files and install</span>
<span class="c"># If you've problems, use 'pacman -U' as root</span></code></pre></figure>

<p><strong>Notice</strong>: people that want it to work even with <em>Windows</em> have to install
the <em>gadget-deadbeef-legacy-dhcp</em> package, as the one above uses a driver which
is not (<em>still</em>) supported from <strong>BeagleBoard</strong> official <em>Windows</em> drivers; so,
just follow the steps above, replacing <em>gadget-deadbeef-dhcp</em> with <em>gadget-deadbeef-legacy-dhcp</em>.</p>

<p><strong>PRO TIP</strong>: I had to reinstall the official <strong>BeagleBoard</strong> drivers, which can
be found <a href="http://beagleboard.org/getting-started#step2">here</a>. I had problems as
<em>Windows 8.1</em> didn’t allow me to install <em>unsigned</em> drivers; so, if you get to
the last step of drivers installation and you get red crosses (<em>error in installation</em>)
and you don’t know why, try reinstalling after doing
<a href="http://www.howtogeek.com/167723/how-to-disable-driver-signature-verification-on-64-bit-windows-8.1-so-that-you-can-install-unsigned-drivers/">this</a>.</p>

<ul>
  <li>Now we have to set up things for hostname resolution. Well’use <em>Samba</em> for this.
It can be used for many more things, but in this case we’ll use just its <strong><em>NetBIOS</em></strong> ability.
So, get <em>Samba</em> and enable the <em>NetBIOS</em> daemon:</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">! pacman -S samba
! cp /etc/samba/smb.conf.default /etc/samba/smb.conf
! systemctl <span class="nb">enable </span>nmbd
! systemctl start nmbd</code></pre></figure>

<ul>
  <li>On the <em>host</em>, enable <em>NetBIOS</em> name resolution by adding <em>wins</em> to the <em>/etc/nsswitch.conf</em> file.
It will look like this:</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>cat /etc/nsswitch.conf 
...
hosts: files wins dns myhostname <span class="c"># See? We added 'wins' </span>
...</code></pre></figure>

<h2 id="and-now">And now?</h2>
<p>Now, just connect with a</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>ssh alarm <span class="c"># Assuming that you've not changed the BeagleBoneBlack hostname</span></code></pre></figure>

<p>No more fuss for looking for IP, setting things or else.
This tutorial is a bit long, but I hope it can be useful to someone. Cheers.</p>

</div>




<!-- AddToAny BEGIN -->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="https://www.addtoany.com/share_save"></a>
<a class="a2a_button_facebook"></a>
<a class="a2a_button_twitter"></a>
<a class="a2a_button_google_plus"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<!-- AddToAny END -->



<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'jasonzhouu';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
        
          <a href="/2015/04/28/android-no-thumbnails/">
        
            Android: Preventing Gallery thumbnails creation
            <small>28 Apr 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
        
          <a href="/2015/04/13/youtube-html5-on-firefox/">
        
            YouTube + HTML5 = PROFIT
            <small>13 Apr 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
        
          <a href="/2015/04/10/introducing-myself/">
        
            Introducing myself
            <small>10 Apr 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
    

  </body>
</html>
