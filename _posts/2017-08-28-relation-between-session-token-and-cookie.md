---
layout: post
title: "session token cookie"
---

# session | token | cookie
为了弄清楚三者的区别与联系，我把他们对应到了现实中的场景——向宿舍宿管借钥匙🔑。

我在学校住宿，房间号是 3100，有时候忘了带钥匙，或者出门刷牙的时候门被风带上了，这时候为了进门，我就得去楼下宿管借钥匙。宿管是轮班的，有的宿管认识我，有的不认识我。

- 如果遇到认识的宿管，他就直接把要是给我了，然后登记。
- 遇到不认识的宿管，就得刷卡，确认我住这个宿舍楼、住这件房之后，才把钥匙给我，然后登记。

session 就像是第一种情况，token 就像是第二种情况。

session 会记住用户，token 不记住用户。什么叫记住用户呢？指的是服务器是否有一个临时存储用户信息的空间，也就是宿管的记忆中是否存有一些用户信息。

## session

session 是服务器端上临时的保存一些用户数据的名值对，在这个例子中，认识我的宿管的记忆就充当了 session 的角色。

在借钥匙时我是靠刷脸，宿管通过我的外貌，对应到他记忆中我的信息，确认我住这栋楼的 3100 号房间。

每个 session 都有 session_id，用户登录时服务器将 session_id 发给客户端。客户端在之后的每次请求中都带上 session_id，服务器根据 session_id 从大量 session 中查找对应的那个，没找到就代表没登录。

宿管记住我同样也有时限，太长时间没见我会忘记我。session 也有时限，超时了会被自动删除 ，用户下次时将需要重新登录。之所以要删除，是因为如果用户量很大，会生成大量 session，将长期不登录的用户临时信息删除，可以节省硬盘空间。

session_id 是服务器以特定规律生成的，攻击者无法获悉其中的规律以生成有效的 session_id，从而可以防止攻击者获得其他用户的访问权限。

## token

但是服务器如果不能保存 session 怎么办，就像宿管不认识我怎么办？那就刷校园卡吧，校园卡是学校发行的，保存了学生的唯一标志——学号。刷卡的时候，电脑检索学生信息数据库，可以看到我是否真的住这栋楼的 3100 号房间，宿管根据这个决定是否给我钥匙。

token 和校园卡一样，保存了用户的唯一标志 user_id。服务器在数据库根据 user_id 进行检索，判断我当前的请求是否有权限。

同时，校园卡经过加密操作，其他人无法仿造。token 也是经过加密的，攻击者无法生成有效的 token 以获得其他用户的访问权限。

## session, token 比较

session 和 token 都是服务器用来分辨用户的方法，其根本区别在于服务器是否临时保存一些用户数据。能保存，就给客户端发送这些临时数据的 id，然后在这临时的数据中查找用户信息；不能保存，则给客户端发送数据库里的用户 id，然后从数据库中查找用户信息。

## session, cookie 比较

session 和 cookie 都是以名值对的形式存储用户信息，根本区别在于存储位置的不同，两者分别保存在服务器和客户端。

两种都各有好处，保存在客户端，可以降低服务器硬盘空间的压力；保存在服务器，可以降低宽带的压力。cookie 和 session_id 在每个请求中都会携带，显然一条字符串 session_id 比存储着大量用户数据的 cookie 小很多。

两者也常有协作，session_id 在浏览器关掉后很快就会被浏览器清除，为了保存更长时间，常常会将 session_id 保存在 cookie 中，cookie 可以保存上十年。